import '../world.dart';

/// Manages temporary invulnerability frames (i-frames).
///
/// **Responsibilities**:
/// *   Decrements invulnerability timers each tick.
/// *   Removes the `InvulnerabilityStore` component when the timer expires.
class InvulnerabilitySystem {
  void step(EcsWorld world) {
    final store = world.invulnerability;
    // Iterate backwards to allow safe removal of entities (Swap-Remove safe).
    for (var i = store.denseEntities.length - 1; i >= 0; i--) {
      // Decrement.
      if (store.ticksLeft[i] > 0) {
        store.ticksLeft[i] -= 1;
      }

      // Cleanup logic: If expired, remove the component so other systems
      // (collision/damage) know the entity is vulnerable again.
      if (store.ticksLeft[i] <= 0) {
        final e = store.denseEntities[i];
        store.removeEntity(e);
      }
    }
  }
}

